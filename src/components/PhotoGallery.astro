---
// This component maps simple image file names to properly resolved
// image imports from the Astro Together gallery folder.

import type { ImageMetadata } from "astro";
import { AstroError } from "astro/errors";
import ImageGallery from "./ImageGallery.astro";

interface Props {
	images: Array<{ src: string; alt: string }>;
}

const imageGlob = import.meta.glob<{ default: ImageMetadata }>(
	"../assets/photogallery/*",
);
const resolvedImages = await Promise.all(
	Astro.props.images.map(async ({ src, alt }) => {
		const imageLoader = imageGlob[`../assets/photogallery/${src}`];

		if (!imageLoader) {
			throw new AstroError(
				`Failed to load gallery image "${src}"`,
				`Couldnâ€™t find \`${src}\` in \`src/assets/photogallery/\`.`,
			);
		}

		const imageModule = await imageLoader();
		return { src: imageModule.default, alt };
	}),
);
---

<ImageGallery images={resolvedImages} />